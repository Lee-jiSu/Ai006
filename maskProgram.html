<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no" />
<title>Human detection - CodeSpeedy</title>
<meta name="theme-color" content="#308455" />
<meta name="robots" content="noindex,nofollow" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<style type="text/css">

@-webkit-keyframes spinner { 
          0% { -webkit-transform: rotate(0deg); }
          100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spinner {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
    
        .spin-it {
           -webkit-animation: spinner 3s linear infinite; 
           animation: spinner 3s linear infinite;
        }
    
    
        header {
            padding: 8px;
            background: red;
            color: white;
            text-align: center;
            margin-bottom: 12px;
        }
        footer{
            padding: 16px;
            background: yellow;
            margin-top: 16px;
            color: black;
        }
        footer a {
            color: #ccc;
        }
        #main {
            margin-top: 10px;
        }
    </style>
</style>

</head>
<body>

	<header>
		<h1> 마스크 감지 프로그램 </h1>
	</header>

	<img
    src="https://www.ksid.or.kr/ncov/include/img/banner_200217.jpg"
    style="display: block; margin: 0 auto; width:2000px; height:300px;"
    / >


<section id="main">
  <div class="container">
     <div class="col-sm-3" id="cnv-width">
	   <div id="video-holder"></div>
     </div>

     <div class="col-sm-6" style="text-align: center;">
  	   <h3>마스크 착용 여부</h3>
  	   <div id="status">
  	   <button type="button" onclick="init()"> 확인하기</button>
		 <div id="webcam-container"></div>
         <div id="label-container"></div>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<script type="text/javascript">
    // More API functions here:
    // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

    // the link to your model provided by Teachable Machine export panel
    const URL = "./my_model/";

    let model, webcam, labelContainer, maxPredictions;

    // Load the image model and setup the webcam
    async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        // load the model and metadata
        // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
        // or files from your local hard drive
        // Note: the pose library adds "tmImage" object to your window (window.tmImage)
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();

        // Convenience function to setup a webcam
        const flip = true; // whether to flip the webcam
        webcam = new tmImage.Webcam(500, 500, flip); // width, height, flip
        await webcam.setup(); // request access to the webcam
        await webcam.play();
        window.requestAnimationFrame(loop);

        // append elements to the DOM
        document.getElementById("webcam-container").appendChild(webcam.canvas);
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions; i++) { // and class labels
            labelContainer.appendChild(document.createElement("div"));
        }
    }

    async function loop() {
        webcam.update(); // update the webcam frame
        await predict();
        window.requestAnimationFrame(loop);
    }


    // run the webcam image through the image model
    async function predict() {
        // predict can take in an image, video or canvas html element
        const prediction = await model.predict(webcam.canvas);
        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
                prediction[i].className + ": " + prediction[i].probability.toFixed(2);
            labelContainer.childNodes[i].innerHTML = classPrediction;
            }
        }
</script>

  	   </div>
     </div>
  </div>
</section>


<footer>
	<div class="container">
		<div class="col-sm-4">
			<p> 오픈소스SW 프로젝트 중간고사 과제 </p>
			<p> 웹캠을 이용한 인식 </p>
			<p> 2018243023 컴퓨터공학과 이지수 </p>
		</div>
	</div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
<script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
<script src="model.js"></script>

</body>
</html>